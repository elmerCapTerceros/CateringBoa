<div class="flex flex-col h-[700px] w-full bg-white"> <div class="p-6 border-b border-gray-200 bg-white shrink-0">
    <div class="flex justify-between items-start mb-4">
        <div>
            <h2 class="text-2xl font-bold text-blue-900 m-0">Selección de Lote</h2>
            <p class="text-sm text-gray-500 mt-1">Marca los ítems necesarios para esta compra.</p>
        </div>
        <button mat-icon-button (click)="cancelar()"><mat-icon>close</mat-icon></button>
    </div>

    <mat-form-field appearance="outline" class="w-full dense-search">
        <mat-icon matPrefix class="text-gray-400 mr-2">search</mat-icon>
        <input matInput placeholder="Buscar producto (ej. Hielo, Vaso...)" [(ngModel)]="terminoBusqueda">
        <button *ngIf="terminoBusqueda" matSuffix mat-icon-button (click)="terminoBusqueda=''">
            <mat-icon>close</mat-icon>
        </button>
    </mat-form-field>
</div>

    <div mat-dialog-content class="flex-1 overflow-y-auto bg-gray-50 p-4">

        @if (itemsFiltrados.length === 0) {
            <div class="flex flex-col items-center justify-center h-40 text-gray-400">
                <mat-icon class="text-4xl mb-2">search_off</mat-icon>
                <p>No se encontraron productos con "{{terminoBusqueda}}"</p>
            </div>
        }

        <div class="grid grid-cols-1 gap-3">
            @for (item of itemsFiltrados; track item.data.id) {

                <div class="flex items-center p-3 rounded-xl border bg-white transition-all hover:shadow-md cursor-pointer group"
                     [class.ring-2]="item.selected"
                     [class.ring-blue-500]="item.selected"
                     [class.bg-blue-50]="item.selected"
                     (click)="toggleSelection(item)">

                    <mat-checkbox
                        [(ngModel)]="item.selected"
                        color="primary"
                        class="mr-3"
                        (click)="$event.stopPropagation()">
                    </mat-checkbox>

                    <div class="flex-1 min-w-0"> <div class="font-bold text-gray-800 truncate">{{ item.data.nombre }}</div>
                        <div class="text-xs text-gray-500">Unidad: {{ item.data.unidad }}</div>
                    </div>

                    <div class="w-28 pl-4 border-l border-gray-100" (click)="$event.stopPropagation()">
                        <mat-form-field appearance="outline" class="w-full bg-white rounded-lg no-bottom-space density-compact" subscriptSizing="dynamic">
                            <mat-label>Cant.</mat-label>
                            <input matInput type="number" min="1" [(ngModel)]="item.cantidad" [disabled]="!item.selected">
                        </mat-form-field>
                    </div>
                </div>
            }
        </div>
    </div>

    <div class="p-4 border-t border-gray-200 bg-white flex justify-between items-center shrink-0">
        <span class="text-sm text-gray-500">
            {{ itemsSeleccionadosCount() }} productos seleccionados
        </span>
        <div class="flex gap-3">
            <button mat-stroked-button (click)="cancelar()">Cancelar</button>
            <button mat-raised-button color="primary"
                    style="background-color: #0B1E47;"
                    (click)="guardar()"
                    [disabled]="!haySeleccionados">
                Agregar al Lote
            </button>
        </div>
    </div>
</div>
