<div class="w-full flex-auto p-6 sm:p-10">

    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8">
        <div>
            <h2 class="text-3xl font-bold tracking-tight">Cierre de Vuelo</h2>
            <p class="text-gray-500">Registro de remanentes y cálculo de consumo.</p>
        </div>
        <div class="mt-4 sm:mt-0 px-4 py-2 bg-green-50 rounded-lg border border-green-100 text-green-800 font-medium">
            <mat-icon class="icon-size-5 mr-2 align-text-bottom">flight_land</mat-icon>
            Estado: Post-Vuelo
        </div>
    </div>

    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 mb-8">
        <form [formGroup]="cierreForm" class="flex flex-col md:flex-row gap-6 items-start">

            <mat-form-field appearance="outline" class="w-full md:w-1/3">
                <mat-label>Seleccionar Vuelo Aterrizado</mat-label>
                <mat-select formControlName="vueloId">
                    @for (vuelo of vuelosPendientes; track vuelo.id) {
                        <mat-option [value]="vuelo.id">
                            {{ vuelo.codigo }} | {{ vuelo.fecha }}
                        </mat-option>
                    }
                </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline" class="w-full md:w-2/3">
                <mat-label>Observaciones del Jefe de Cabina</mat-label>
                <input matInput formControlName="observaciones" placeholder="Ej. Se rompieron 2 botellas durante turbulencia">
            </mat-form-field>

        </form>
    </div>

    <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
        <table class="w-full">
            <thead>
            <tr class="text-left text-white" style="background-color: #0B1E47;">
                <th class="p-4 font-medium">Ítem</th>
                <th class="p-4 font-medium text-center w-32">Carga Inicial</th>
                <th class="p-4 font-medium text-center w-32 bg-blue-900">Remanente (Sobrante)</th>
                <th class="p-4 font-medium text-center w-32">Consumo Real</th>
                <th class="p-4 font-medium w-40">Estado Retorno</th>
            </tr>
            </thead>
            <tbody class="divide-y divide-gray-100">
                @for (item of listaItems; track $index) {
                    <tr class="hover:bg-gray-50">
                        <td class="p-4 font-medium text-gray-800">{{ item.nombre }}</td>

                        <td class="p-4 text-center text-gray-500 font-medium">
                            {{ item.cantidadCargada }}
                        </td>

                        <td class="p-4 bg-blue-50">
                            <input
                                type="number"
                                min="0"
                                [max]="item.cantidadCargada"
                                class="w-full text-center border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 font-bold text-blue-900 p-2 border"
                                [(ngModel)]="item.remanente"
                                (change)="calcularConsumo($index)"
                                (keyup)="calcularConsumo($index)">
                        </td>

                        <td class="p-4 text-center font-bold text-lg text-green-700">
                            {{ item.consumido }}
                        </td>

                        <td class="p-4">
                            <select
                                class="w-full text-sm border-gray-200 rounded-md focus:ring-blue-500 focus:border-blue-500 p-2 border"
                                [(ngModel)]="item.estado">
                                <option value="Normal">Retorno a Stock</option>
                                <option value="Desecho">Desechar</option>
                                <option value="Merma">Merma/Roto</option>
                            </select>
                        </td>
                    </tr>
                }
                @if (listaItems.length === 0) {
                    <tr>
                        <td colspan="5" class="p-12 text-center text-gray-400">
                            Seleccione un vuelo arriba para cargar el manifiesto de carga.
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <div class="mt-8 flex justify-end">
        <button
            mat-raised-button
            color="primary"
            class="px-8 py-2 text-lg"
            style="background-color: #0B1E47; height: 50px;"
            (click)="guardarCierre()">
            <mat-icon class="mr-2">save</mat-icon>
            Cerrar Vuelo y Guardar
        </button>
    </div>
</div>
