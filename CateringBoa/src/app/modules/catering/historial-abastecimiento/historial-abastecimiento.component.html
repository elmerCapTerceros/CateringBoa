<div class="w-full flex-auto p-6 sm:p-10">

    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8">
        <div>
            <h2 class="text-3xl font-bold tracking-tight">Historial de Abastecimientos</h2>
            <p class="text-gray-500">Control y auditoría de cargas realizadas.</p>
        </div>

        <button mat-raised-button color="primary" style="background-color: #0B1E47;">
            <mat-icon class="mr-2">add</mat-icon>
            Nuevo Abastecimiento
        </button>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
        <mat-form-field appearance="outline" class="w-full">
            <mat-label>Buscar por Vuelo</mat-label>
            <input matInput placeholder="Ej. OB-760">
            <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>

        <mat-form-field appearance="outline" class="w-full">
            <mat-label>Filtrar por Fecha</mat-label>
            <mat-select value="hoy">
                <mat-option value="hoy">Hoy</mat-option>
                <mat-option value="semana">Esta Semana</mat-option>
                <mat-option value="mes">Este Mes</mat-option>
            </mat-select>
        </mat-form-field>
    </div>

    <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
        <table class="w-full">
            <thead>
            <tr class="text-left text-white" style="background-color: #0B1E47;">
                <th class="p-4 font-medium">Vuelo / Ruta</th>
                <th class="p-4 font-medium">Fecha Hora</th>
                <th class="p-4 font-medium">Configuración Usada</th>
                <th class="p-4 font-medium">Responsable</th>
                <th class="p-4 font-medium text-center">Ítems Total</th>
                <th class="p-4 font-medium text-right">Acciones</th>
            </tr>
            </thead>
            <tbody class="divide-y divide-gray-100">
                @for (row of historial; track row.id) {
                    <tr class="hover:bg-gray-50 transition-colors">
                        <td class="p-4">
                            <div class="font-bold text-gray-800">{{ row.vuelo }}</div>
                            <div class="text-xs text-gray-500">{{ row.ruta }}</div>
                        </td>
                        <td class="p-4 text-gray-600">{{ row.fecha }}</td>
                        <td class="p-4 text-gray-600">
                            <span class="bg-blue-50 text-blue-700 px-2 py-1 rounded text-xs font-bold">
                                {{ row.plantilla }}
                            </span>
                        </td>
                        <td class="p-4 text-gray-600 text-sm">{{ row.usuario }}</td>
                        <td class="p-4 text-center font-bold text-lg">{{ row.itemsCount }}</td>
                        <td class="p-4 text-right">
                            <button mat-icon-button color="accent" (click)="toggleDetalle(row)" matTooltip="Ver Carga">
                                <mat-icon>{{ row.expandido ? 'expand_less' : 'visibility' }}</mat-icon>
                            </button>
                            <button mat-icon-button color="primary" (click)="imprimirManifiesto(row)">
                                <mat-icon>print</mat-icon>
                            </button>
                        </td>
                    </tr>

                    @if (row.expandido) {
                        <tr class="bg-gray-50">
                            <td colspan="6" class="p-4 shadow-inner">
                                <div class="flex flex-col sm:flex-row gap-4">
                                    <div class="w-full sm:w-1/2">
                                        <h4 class="font-bold text-gray-700 mb-2 text-sm uppercase tracking-wider">Detalle de Carga</h4>
                                        <ul class="space-y-2">
                                            @for (item of row.detalle; track item.nombre) {
                                                <li class="flex justify-between text-sm border-b border-gray-200 pb-1 last:border-0">
                                                    <span class="text-gray-600">{{ item.nombre }}</span>
                                                    <span class="font-bold text-gray-800">{{ item.cantidad }} un.</span>
                                                </li>
                                            }
                                        </ul>
                                    </div>
                                    <div class="w-full sm:w-1/2 border-l border-gray-200 pl-4">
                                        <h4 class="font-bold text-gray-700 mb-2 text-sm uppercase tracking-wider">Auditoría</h4>
                                        <p class="text-xs text-gray-500">Carga verificada por seguridad.</p>
                                        <p class="text-xs text-gray-500">Precintos: OK</p>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>
</div>
