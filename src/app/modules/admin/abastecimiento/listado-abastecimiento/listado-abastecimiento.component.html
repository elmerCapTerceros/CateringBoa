<div class="flex-auto p-6 sm:p-10">

    <div class="mb-8">
        <h2 class="text-3xl font-bold tracking-tight">Abastecimiento</h2>
        <h3 class="text-xl text-gray-600">Aeronave</h3>
    </div>

    <form [formGroup]="abastecimientoForm" (ngSubmit)="guardarAbastecimiento()">

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">

            <mat-form-field appearance="outline" class="w-full">
                <mat-label>Seleccionar almacen</mat-label>
                <mat-select formControlName="almacen">
                    @for (almacen of almacenes; track almacen.value) {
                        <mat-option [value]="almacen.value">{{almacen.viewValue}}</mat-option>
                    }
                </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline" class="w-full">
                <mat-label>Fecha requerida</mat-label>
                <input matInput [matDatepicker]="picker" formControlName="fecha" placeholder="dd/mm/aaaa">
                <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                <mat-datepicker #picker></mat-datepicker>
            </mat-form-field>

            <mat-form-field appearance="outline" class="w-full">
                <mat-label>Seleccionar Carga</mat-label>
                <mat-select formControlName="carga">
                    @for (carga of cargas; track carga.value) {
                        <mat-option [value]="carga.value">{{carga.viewValue}}</mat-option>
                    }
                </mat-select>
            </mat-form-field>
        </div>

        <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2">Clases:</label>
            <mat-radio-group formControlName="clase" class="flex gap-6">
                <mat-radio-button value="Business">Business</mat-radio-button>
                <mat-radio-button value="Economica">Economica</mat-radio-button>
            </mat-radio-group>
        </div>

        <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-semibold">
                Ítems solicitados: <span class="text-red-500">*</span>
            </h3>
            <button
                mat-button
                color="primary"
                type="button"
                (click)="agregarItem()">
                <mat-icon class="mr-1">add</mat-icon>
                Agregar ítem
            </button>
        </div>

        <div class="rounded-lg border overflow-hidden">

            <div class="grid grid-cols-12 gap-4 p-4 bg-gray-50 border-b">
                <div class="col-span-4 font-semibold text-sm text-gray-600">CATEGORÍA</div>
                <div class="col-span-4 font-semibold text-sm text-gray-600">NOMBRE DE ÍTEM</div>
                <div class="col-span-3 font-semibold text-sm text-gray-600">CANTIDAD</div>
                <div class="col-span-1"></div> </div>

            <div formArrayName="items">
                @for (item of items.controls; track $index) {
                    <div [formGroupName]="$index" class="grid grid-cols-12 gap-4 p-4 border-b last:border-b-0 items-start">

                        <div class="col-span-4">
                            <mat-form-field appearance="outline" class="w-full">
                                <mat-label>Categoría</mat-label>
                                <input matInput formControlName="categoria" placeholder="Ej: Electrónica">
                            </mat-form-field>
                        </div>

                        <div class="col-span-4">
                            <mat-form-field appearance="outline" class="w-full">
                                <mat-label>Nombre de Ítem</mat-label>
                                <input matInput formControlName="nombreItem" placeholder="Ej: Mouse inalámbrico">
                            </mat-form-field>
                        </div>

                        <div class="col-span-3">
                            <mat-form-field appearance="outline" class="w-full">
                                <mat-label>Cantidad</mat-label>
                                <input matInput type="number" formControlName="cantidad" placeholder="0" min="0">
                            </mat-form-field>
                        </div>

                        <div class="col-span-1 flex justify-center pt-2">
                            <button
                                mat-icon-button
                                color="warn"
                                type="button"
                                (click)="eliminarItem($index)"
                                matTooltip="Eliminar ítem">
                                <mat-icon>delete</mat-icon>
                            </button>
                        </div>
                    </div>
                }
            </div>

            @if (items.length === 0) {
                <div class="text-center p-8 text-gray-500">
                    No hay ítems agregados. Haz clic en "Agregar ítem" para comenzar.
                </div>
            }
        </div>

        <div class="flex justify-end gap-4 mt-8">
            <button
                mat-stroked-button
                type="button">
                Cancelar
            </button>
            <button
                mat-raised-button
                color="primary"
                type="submit">
                Guardar Abastecimiento
            </button>
        </div>

    </form>
</div>
