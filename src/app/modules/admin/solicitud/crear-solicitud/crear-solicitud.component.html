<div class="flex-auto p-6 sm:p-10">
    <h2 class="text-3xl font-bold mb-8">Crear Nueva Solicitud</h2>

    <form [formGroup]="solicitudForm" (ngSubmit)="guardarSolicitud()">

        <!-- Fila 1: Almacén y Fecha -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <!-- Almacén -->
            <div>
                <mat-form-field appearance="outline" class="w-full">
                    <mat-label>Almacén solicitante:</mat-label>
                    <mat-select formControlName="almacen" placeholder="Seleccionar almacén">
                        @for (almacen of almacenes; track almacen.value) {
                            <mat-option [value]="almacen.value">{{almacen.viewValue}}</mat-option>
                        }
                    </mat-select>
                </mat-form-field>
            </div>

            <!-- Fecha -->
            <div>
                <mat-form-field appearance="outline" class="w-full">
                    <mat-label>Fecha requerida:</mat-label>
                    <input matInput [matDatepicker]="picker" formControlName="fecha" placeholder="dd/mm/aaaa">
                    <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                    <mat-datepicker #picker></mat-datepicker>
                </mat-form-field>
            </div>
        </div>

        <!-- Fila 2: Prioridad -->
        <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2">Prioridad:</label>
            <mat-radio-group formControlName="prioridad" class="flex gap-6">
                <mat-radio-button value="1">Alta</mat-radio-button>
                <mat-radio-button value="2">Media</mat-radio-button>
                <mat-radio-button value="3">Baja</mat-radio-button>
            </mat-radio-group>
        </div>

        <!-- Fila 3: Descripción -->
        <div class="mb-6">
            <mat-form-field appearance="outline" class="w-full">
                <mat-label>Descripción:</mat-label>
                <textarea
                    matInput
                    formControlName="descripcion"
                    rows="3"
                    placeholder="Escriba una descripción detallada de la solicitud"></textarea>
            </mat-form-field>
        </div>

        <!-- Tabla de Items Solicitados -->
        <mat-card class="mb-6">
            <mat-card-header class="flex justify-between items-center pb-4">
                <div>
                    <mat-card-title class="text-base font-semibold">
                        Ítems solicitados: <span class="text-red-500">*</span>
                    </mat-card-title>
                </div>
                <button
                    mat-button
                    color="primary"
                    type="button"
                    (click)="agregarItem()"
                    class="flex items-center gap-1">
                    <mat-icon>add</mat-icon>
                    Agregar ítem
                </button>
            </mat-card-header>

            <mat-card-content>
                <!-- Encabezados -->
                <div class="grid grid-cols-12 gap-4 mb-4 px-2 text-sm font-semibold text-gray-600">
                    <div class="col-span-3">CATEGORÍA</div>
                    <div class="col-span-4">NOMBRE DE ÍTEM</div>
                    <div class="col-span-3">CANTIDAD</div>
                    <div class="col-span-2"></div>
                </div>

                <!-- Items dinámicos -->
                <div formArrayName="items">
                    @for (item of items.controls; track $index) {
                        <div [formGroupName]="$index" class="grid grid-cols-12 gap-4 mb-3 items-start">

                            <!-- Categoría -->
                            <div class="col-span-3">
                                <mat-form-field appearance="outline" class="w-full">
                                    <mat-select formControlName="categoria" placeholder="Seleccione Categoria">
                                        @for (cat of categorias; track cat) {
                                            <mat-option [value]="cat">{{ cat }}</mat-option>
                                        }
                                    </mat-select>
                                </mat-form-field>
                            </div>

                            <!-- Nombre del ítem -->
                            <div class="col-span-4">
                                <mat-form-field appearance="outline" class="w-full">
                                    <input
                                        matInput
                                        formControlName="nombre"
                                        placeholder="Seleccione Item">
                                </mat-form-field>
                            </div>

                            <!-- Cantidad -->
                            <div class="col-span-3">
                                <mat-form-field appearance="outline" class="w-full">
                                    <input
                                        matInput
                                        type="number"
                                        formControlName="cantidad"
                                        placeholder="0"
                                        min="0">
                                </mat-form-field>
                            </div>

                            <!-- Botón eliminar -->
                            <div class="col-span-2 flex items-center pt-2">
                                <button
                                    mat-icon-button
                                    color="warn"
                                    type="button"
                                    (click)="eliminarItem($index)"
                                    matTooltip="Eliminar ítem">
                                    <mat-icon>delete</mat-icon>
                                </button>
                            </div>
                        </div>
                    }
                </div>

                <!-- Mensaje si no hay items -->
                @if (items.length === 0) {
                    <div class="text-center py-8 text-gray-500">
                        No hay ítems agregados. Haz clic en "Agregar ítem" para comenzar.
                    </div>
                }
            </mat-card-content>
        </mat-card>
        <!-- Botones de acción -->
        <div class="flex justify-end gap-4 mt-8">
            <button
                mat-stroked-button
                type="button"
                (click)="cancelar()">
                Cancelar
            </button>
            <button
                mat-raised-button
                color="primary"
                type="submit">
                Crear Solicitud
            </button>
        </div>
    </form>
</div>
