<div class="w-full flex-auto p-6 sm:p-10">

    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8">
        <div>
            <h2 class="text-3xl font-bold tracking-tight">Abastecer Vuelo</h2>
            <p class="text-gray-500">Asigna la carga a un vuelo programado.</p>
        </div>
        <div class="mt-4 sm:mt-0 px-4 py-2 bg-blue-50 rounded-lg border border-blue-100 text-blue-800 font-medium">
            <mat-icon class="icon-size-5 mr-2 align-text-bottom">flight_takeoff</mat-icon>
            Estado: Planificación
        </div>
    </div>

    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 mb-8">
        <form [formGroup]="vueloForm" class="grid grid-cols-1 md:grid-cols-3 gap-6">

            <mat-form-field appearance="outline" class="w-full">
                <mat-label>Seleccionar Vuelo</mat-label>
                <mat-select formControlName="vueloId">
                    @for (vuelo of vuelosProgramados; track vuelo.id) {
                        <mat-option [value]="vuelo.id">
                            <span class="font-bold">{{ vuelo.codigo }}</span>
                            | {{ vuelo.ruta }} ({{ vuelo.avion }})
                        </mat-option>
                    }
                </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline" class="w-full">
                <mat-label>Fecha de Vuelo</mat-label>
                <input matInput [matDatepicker]="picker" formControlName="fecha">
                <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                <mat-datepicker #picker></mat-datepicker>
            </mat-form-field>

            <mat-form-field appearance="outline" class="w-full">
                <mat-label>Aplicar Configuración Base</mat-label>
                <mat-select formControlName="configuracionId">
                    @for (conf of configuracionesDisponibles; track conf.id) {
                        <mat-option [value]="conf.id">{{ conf.nombre }}</mat-option>
                    }
                </mat-select>
                <mat-hint>Esto cargará los ítems automáticamente</mat-hint>
            </mat-form-field>

        </form>
    </div>

    <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">

        <div class="p-4 border-b border-gray-200 flex justify-between items-center bg-gray-50">
            <h3 class="font-bold text-gray-700">Detalle de Carga</h3>
            <button mat-stroked-button color="primary" (click)="agregarItemExtra()">
                <mat-icon>add</mat-icon>
                Añadir Ítem Extra
            </button>
        </div>

        <table class="w-full">
            <thead>
            <tr class="text-left text-white" style="background-color: #0B1E47;">
                <th class="p-4 font-medium">Ítem</th>
                <th class="p-4 font-medium text-center w-32">Carga Base</th>
                <th class="p-4 font-medium text-center w-32">Carga Extra</th>
                <th class="p-4 font-medium text-center w-32">Total</th>
                <th class="p-4 font-medium text-right w-20"></th>
            </tr>
            </thead>
            <tbody class="divide-y divide-gray-100">
                @for (item of listaCarga; track $index) {
                    <tr class="hover:bg-gray-50">
                        <td class="p-4 font-medium text-gray-800">{{ item.nombre }}</td>

                        <td class="p-4 text-center">
                            <span class="bg-gray-100 text-gray-600 px-3 py-1 rounded-full text-sm font-bold">
                                {{ item.cantidadBase }}
                            </span>
                        </td>

                        <td class="p-4">
                            <input
                                type="number"
                                min="0"
                                class="w-full text-center border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2 border"
                                [(ngModel)]="item.cantidadExtra"
                                (change)="actualizarTotal($index)">
                        </td>

                        <td class="p-4 text-center font-bold text-lg text-blue-900">
                            {{ item.total }}
                        </td>

                        <td class="p-4 text-right">
                            <button mat-icon-button color="warn" (click)="eliminarFila($index)">
                                <mat-icon>close</mat-icon>
                            </button>
                        </td>
                    </tr>
                }
                @if (listaCarga.length === 0) {
                    <tr>
                        <td colspan="5" class="p-12 text-center text-gray-400">
                            <mat-icon class="icon-size-12 mb-4 text-gray-300">format_list_bulleted</mat-icon>
                            <p>Seleccione una configuración arriba para cargar los ítems.</p>
                        </td>
                    </tr>
                }
            </tbody>
            @if (listaCarga.length > 0) {
                <tfoot class="bg-gray-50">
                <tr>
                    <td colspan="3" class="p-4 text-right font-bold text-gray-600">TOTAL ÍTEMS A CARGAR:</td>
                    <td class="p-4 text-center font-bold text-xl text-gray-900">
                        {{ listaCarga.length }}
                    </td>
                    <td></td>
                </tr>
                </tfoot>
            }
        </table>
    </div>

    <div class="mt-8 flex justify-end gap-4">
        <button mat-stroked-button class="px-8 py-2">Cancelar</button>
        <button
            mat-raised-button
            color="primary"
            class="px-8 py-2 text-lg"
            style="background-color: #0B1E47; height: 50px;"
            (click)="confirmarAbastecimiento()">
            <mat-icon class="mr-2">check_circle</mat-icon>
            Confirmar Abastecimiento
        </button>
    </div>

</div>
